
# https://guacamole.apache.org/doc/0.9.0/gug/installing-guacamole.html
  # Fedora, RHEL, and CentOS
    # setup repos, selinux, and reboot
    yum update -y
    yum -y install vim screen
    scp /home/rac3rx/.screenrc root@centos7-vm:/root/
    yum -y install epel
    rpm -Uvh https://download1.rpmfusion.org/free/el/rpmfusion-free-release-7.noarch.rpm
    sed -i 's/=enforcing/=permissive/' /etc/selinux/config
    systemctl reboot -i

    # install guacamole and guacd
    # yum install guacamole guacd                                           # fails, not in repo
    # yum install tomcat tomcat-webapps                                     # a ref only

    # yum -y install cairo-devel ffmpeg-devel freerdp-devel freerdp-plugins gcc gnu-free-mono-fonts libjpeg-turbo-devel libjpeg-devel libpng-devel libssh2-devel libssh-devel libtelnet-devel libtool libvncserver-devel libvorbis-devel libwebp-devel libwebsockets-devel openssl-devel pango-devel pulseaudio-libs-devel uuid-devel

    yum -y groupinstall "Development Tools"
    #yum -y install wget

    cd /tmp
    wget -ct 3 https://archive.apache.org/dist/guacamole/1.3.0/source/guacamole-server-1.3.0.tar.gz
    wget -ct 3 https://archive.apache.org/dist/guacamole/1.3.0/source/guacamole-client-1.3.0.tar.gz

    tar xzvf server.tar.gz
    cd guacamole-server-0.9.14
    ./configure --with-init-dir=/etc/init.d
    make
    make install
    ldconfig

    /etc/init.d/guacd start
    yum -y install java-1.8.0-openjdk-devel.x86_64
    yum -y install ant

groupadd tomcat
useradd -M -s /bin/false -g tomcat -d /opt/tomcat tomcat
#useradd -M -s /bin/nologin -g tomcat -d /opt/tomcat tomcat
useradd -m -U -d /opt/tomcat -s /bin/false tomcat

    curl -O https://mirrors.ocf.berkeley.edu/apache/tomcat/tomcat-8/v8.5.61/src/apache-tomcat-8.5.61-src.tar.gz
    mkdir -p /opt/tomcat
    cd /opt/tomcat
    tar zxvf /tmp/apache-tomcat-8.5.61-src.tar.gz
    cd apache-tomcat-8.5.61-src/
    ln -s /opt/tomcat/apache-tomcat-8.5.61-src/ /opt/tomcat/latest
    chgrp -R tomcat /opt/tomcat
    chmod -R g+r /opt/tomcat/latest/conf/
    chmod g+x /opt/tomcat/latest/conf/
    for i in webapps work temp logs; do mkdir /opt/tomcat/latest/$i; done
    for i in webapps work temp logs; do chown -R tomcat /opt/tomcat/latest/$i; done
    chmod +x /opt/tomcat/apache-tomcat-8.5.61-src/bin/*.sh

cat <<EOF> /etc/systemd/system/tomcat.service
# Systemd unit file for tomcat
[Unit]
Description=Apache Tomcat Web Application Container
After=syslog.target network.target

[Service]
Type=forking

Environment="JAVA_HOME=$(dirname $(dirname $(readlink $(readlink $(which javac)))))"
Environment=CATALINA_PID=/opt/tomcat/latest/temp/tomcat.pid
Environment=CATALINA_HOME=/opt/tomcat/latest
Environment=CATALINA_BASE=/opt/tomcat/latest
Environment='CATALINA_OPTS=-Xms512M -Xmx1024M -server -XX:+UseParallelGC'
Environment='JAVA_OPTS=-Djava.awt.headless=true -Djava.security.egd=file:/dev/./urandom'

ExecStart=/opt/tomcat/latest/bin/startup.sh
ExecStop=/bin/kill -15 $MAINPID

User=tomcat
Group=tomcat
UMask=0007
RestartSec=10
Restart=always

[Install]
WantedBy=multi-user.target
EOF


firewall-cmd --permanent --zone=drop --add-source=0.0.0.0
firewall-cmd --permanent --zone=drop --add-source=::
firewall-cmd --permanent --zone=drop --add-port=443/tcp
firewall-cmd --permanent --zone=drop --add-port=8080/tcp
firewall-cmd --permanent --zone=drop --add-port=8443/tcp
firewall-cmd --permanent --zone=drop --add-rich-rule='rule family="ipv4"
source address="172.16.92.131" port port="22" protocol="tcp" accept'
firewall-cmd --permanent --zone=drop --add-rich-rule='rule family="ipv4"
source address="172.16.22.132" port port="22" protocol="tcp" accept'
firewall-cmd --permanent --zone=drop --add-rich-rule='rule family="ipv6"
source address="11:22:33:401::11" port port="22" protocol="tcp" accept'
firewall-cmd --permanent --zone=drop --add-rich-rule='rule family="ipv6"
source address="11:22:33:401::12" port port="22" protocol="tcp" accept'
firewall-cmd --permanent --zone public --remove-interface ens33
firewall-cmd --permanent --zone=public --remove-service=ssh
firewall-cmd --permanent --zone=public --remove-service=dhcpv6-client
firewall-cmd --permanent --zone drop --add-interface ens33
firewall-cmd --reload

firewall-cmd --get-active-zones
firewall-cmd --list-all-zones

cp /opt/tomcat/latest/conf/tomcat-users.xml /opt/tomcat/latest/conf/tomcat-users.xml.000
echo '<tomcat-users xmlns="http://tomcat.apache.org/xml"; 
       xmlns:xsi="http://www.w3.org/2001/XMLSchema-instance";
       xsi:schemaLocation="http://tomcat.apache.org/xml tomcat-users.xsd"
       version="1.0">
   <role rolename="admin-gui"/>
   <role rolename="manager-gui"/>
   <role rolename="manager-scripts"/>
   <user username="admin" password="admin"
roles="admin-gui,manager-gui,manager-scripts"/>
</tomcat-users>' > /opt/tomcat/latest/conf/tomcat-users.xml

# Disable the firewall while completing tomcat setup:
systemctl disable firewalld;systemctl stop firewalld

curl -O https://archive.apache.org/dist/tomcat/tomcat-connectors/native/1.2.26/source/tomcat-native-1.2.26-src.tar.gz
tar xzvf tomcat-native-1.2.26-src.tar.gz
cd tomcat-native-1.2.26-src/native

# setup JAVA_HOME
echo '# setup JAVA_HOME' >> ~/.bash_profile
echo 'export JAVA_HOME=$(dirname $(dirname $(readlink $(readlink $(which javac)))))' >> ~/.bash_profile
echo 'export PATH=$PATH:$JAVA_HOME/bin' >> ~/.bash_profile
echo 'export CLASSPATH=.:$JAVA_HOME/jre/lib:$JAVA_HOME/lib:$JAVA_HOME/lib/tools.jar' >> ~/.bash_profile
. ~/.bash_profile

yum install apr-devel openssl-devel
#./configure --with-java-home /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.275.b01-0.el7_9.x86_64/
./configure
make
make install 

systemctl daemon-reload
systemctl restart tomcat

# Permits java to listen on any privileged port, ie ports 1-1024:
setcap cap_net_bind_service+ep /usr/lib/jvm/java-1.8.0-openjdk-1.8.0.275.b01-0.el7_9.x86_64/jre/bin/java

echo '/usr/lib/jvm/java-1.8.0-openjdk-1.8.0.275.b01-0.el7_9.x86_64/jre/lib/amd64/jli/' >> /etc/ld.so.conf.d/java.conf
systemctl daemon-reload
reboot

# Configure use of PKI:
#>>>> Copy from Windows our.pfx ---> /root/
# The Windows our.pfx file must include a full certificate chain to a trusted CA certificate.
#cd ~
#mv /root/our.pfx /opt/tomcat/latest/conf/US.pfx













  # comm protocols
    yum install libguac-client-vnc libguac-client-ssh libguac-client-rdp    # freerdp-devel & freerdp-plugins alternatively

  # enable services
    systemctl enable tomcat6.service
    systemctl enable guacd

  # firewall
    firewall-cmd --permanent --add-port=8080/tcp
    firewall-cmd --reload


https://kcshares.blogspot.com/2020/02/
Step 1.  Of course, you need to install a new system.  During the installation, remember to set few things to avoid manual
change later.

    [ ] set time zone
    [ ] set network configuration
    [ ] firewall
    [ ] selinux
    [ ] set storage
    [ ] select minimal server packages
    [ ] begin installation
    [ ] set root password


# Step 2. After installation reboot, it's a good practice to keep your system up-to-date.

    yum update -y
    systemctl reboot -i

# Reboot


# Step 3. Install some dependency packages.  The following list all packages to be installed. 
    yum install -y cairo-devel
    yum install -y libjpeg-turbo-devel
    yum install -y libpng-devel
    yum install -y libtool
    yum install -y uuid-devel

    yum install epel-release
    #rpm -v --import http://li.nux.ro/download/nux/RPM-GPG-KEY-nux.ro
    #rpm -Uvh http://li.nux.ro/download/nux/dextop/el7/x86_64/nux-dextop-release-0-5.el7.nux.noarch.rpm
    yum install -y ffmpeg-devel
    yum install -y freerdp-devel
    yum install -y libssh2-devel
    yum install -y libtelnet-devel
    yum install -y libvncserver-devel
    yum install -y libvorbis-devel
    yum install -y libwebp-devel
    yum install -y libwebsockets-devel
    yum install -y openssl-devel
    yum install -y pango-devel
    yum install -y pulseaudio-libs-devel

wget -ct 3 https://archive.apache.org/dist/guacamole/1.3.0/source/guacamole-server-1.3.0.tar.gz
wget -ct 3 https://archive.apache.org/dist/guacamole/1.3.0/source/guacamole-client-1.3.0.tar.gz






REF:
https://guacamole.apache.org/doc/1.0.0/gug/installing-guacamole.html
https://guacamole.apache.org/doc/0.9.0/gug/installing-guacamole.html
https://guacamole.apache.org/releases/
https://github.com/apache/guacamole-server

# More thorough
https://kcshares.blogspot.com/2020/02/

https://kifarunix.com/how-to-install-and-configure-guacamole-on-fedora-29/

https://deviant.engineer/2016/11/guacamole-incubator-centos7/

https://raw.githubusercontent.com/Zer0CoolX/guacamole-install-rhel-7/master/guac-install.sh

https://alibaba-cloud.medium.com/how-to-create-virtual-cloud-desktop-using-apache-guacamole-283498620571

# Probably the most extensive instructions
https://www.mail-archive.com/user@guacamole.apache.org/msg02507.html

https://www.digitalocean.com/community/tutorials/how-to-install-apache-tomcat-8-on-centos-7

